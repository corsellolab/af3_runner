// include config 
includeConfig 'conf/resources.config'

singularity.enabled = true

// Report configurations
report {
    enabled = true
    file = "${params.output_dir}/report.html"
}

timeline {
    enabled = true
    file = "${params.output_dir}/timeline.html"
}

// Global executor settings
process {
    executor = 'slurm'
    errorStrategy = { task.exitStatus in [140,143,137,104,134,139] ? 'retry' : 'terminate' }
    maxRetries = 3
    shell = ['/bin/bash', '-euo', 'pipefail']
}

// Process profiles
profiles {
    cpu_high {
        process {
            cpus = 8
            queue = "normal,owner"
            memory = '32 GB'
            clusterOptions = """
                --nodes=1
                --cpus-per-task=8
                --mem=32G
            """
        }
    }
    
    gpu_high {
        process {
            cpus = 8
            queue = "owners,gpu"
            memory = '32 GB'
            clusterOptions = """
                --nodes=1
                --cpus-per-task=8
                --mem=32G
                --gres=gpu:1
                --constraint=GPU_MEM:80GB
            """
        }
    }
} 